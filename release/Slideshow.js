/*!
 * Slideshow
 * A simple slideshow framework.
 * 
 * @author Dolphin Wood https://idiotwu.me
 * @version 0.3.0
 * Copyright 2015. MIT licensed.
 */
var Slideshow=function(a){"use strict";var b,c,d,e,f=[],g={},h=function(a){a&&"function"==typeof a&&setTimeout(a,0)},i=function(){for(var c in g)g[c].call(a,b)},j=function(a){var c=a.indexChain.split("."),d=b.getChild(c[0]);if(d){var e=d.flatten(!0),f=a.index;e.forEach(function(a){var b=a.element,c=a.index;f>=c?(b.classList.add("show"),1===a.depth||c===f?b.classList.remove("played"):b.classList.add("played")):(b.classList.remove("played"),b.classList.remove("show"))})}},k=function(a){var b,c;return function(){var d=arguments,e=(new Date).getTime();if(!b)return b=e,a.apply(null,d);var f=300-(e-b);return 0>=f?(clearTimeout(c),c=void 0,b=e,a.apply(null,d)):void(c||(c=setTimeout(function(){b=(new Date).getTime(),c=void 0,a.apply(null,d)},f)))}},l=function(a){var b=c[d],g=b.element,i=d/e;location.hash=b.indexChain,f.forEach(function(c){h(function(){c.call(b,a,g,i)})})},m=function(){var a=c[d+1];if(!a)return null;var e=c[d],f=a.element,g=a.indexChain;if(1!==e.depth&&e.element.classList.add("played"),1===a.depth){var h=b.getChild(g-1),i=h.element;i.classList.remove("show"),i.classList.add("played"),j(a)}else f.classList.add("show");d++,l("next")},n=function(){if(!d)return null;var a=c[d],b=c[--d],e=b.element;1===a.depth?j(b):e.classList.remove("played"),a.element.classList.remove("show"),l("prev")},o=function(a){if(!a&&0!==a)throw new TypeError("missing argument indexChain");if(a=a.toString(),!a.match(/^(?:\d\.?)*\d$/))throw new TypeError("unrecognized indexChain format, require ^(\\d\\.?)*\\d$");var e=c[d].indexChain,f=b.getChild(a);if(a!==e&&f){d=f.index;var g=e.split(".")[0],h=a.split(".")[0];h!==g&&b.children[g].element.classList.remove("show"),j(f),b.children.forEach(function(a,b){h>b?a.element.classList.add("played"):a.element.classList.remove("played")}),l("jump")}};return a.next=k(m),a.prev=k(n),a.jumpTo=k(o),a.init=function(g,j){if(!document.body.classList)throw new Error("unsupported browser");return b=a.finder(g,j),c=b.flatten(),d=0,e=c.length-1,f.length=0,c.length&&c[0].element.classList.add("show"),location.hash&&h(function(){try{a.jumpTo(location.hash.slice(1))}catch(b){}}),i(),b},a.addListener=function(a){if("function"!=typeof a)throw new TypeError("onchange listener must be a function");f.push(a)},a.removeListener=function(){f.length=0},a.registerPlugin=function(a,b){if("string"!=typeof a)throw new TypeError("the 1st parameter should be a string");if("function"!=typeof b)throw new TypeError("the 2nd parameter should be a function");g[a]=b},a.getAllPlugins=function(){return g},a.getCurrentFrame=function(){return c&&c[d]},a}(window.Slideshow||{}),Slideshow=function(a){"use strict";var NodeTree=function(a,b,c){return this.element=a||"root",this.depth=c||0,this.parent=b,this.children=[],this.description=a&&a.getAttribute("data-title"),b?this.indexChain=(b.indexChain?b.indexChain+".":"")+b.children.length:this.indexChain=void 0,this};return NodeTree.prototype.wrap=function(){var a=document.createElement("section");if(this.depth){var b=this.element.cloneNode(!0);return a.appendChild(b),a}return this.children.forEach(function(b){var c=b.element.cloneNode(!0);a.appendChild(c)}),a},NodeTree.prototype.toHTML=function(){return this.wrap().innerHTML},NodeTree.prototype.toTitleList=function(){var a='<a data-index-chain="{{indexChain}}" data-index="{{index}}" href="#{{indexChain}}">{{description}}</a>',b=/\{{2}([^}]+)\}{2}/g,c=function(c,d,e){var f=document.createElement("li");return c.appendChild(f),f.innerHTML=a.replace(b,function(a,b){var c=d[b];return c||0===c?c:""}),e&&(f.children[0].className=e),f};return function(a,b){var d=this.children.length;if(!d&&!b)return null;var e=document.createElement("ol"),f=e;if(b&&this.depth){var g=c(e,this,a);d&&(f=document.createElement("ol"),g.appendChild(f))}return this.children.forEach(function(b){var d=c(f,b,a);b.children.length&&d.appendChild(b.toTitleList(a))}),e}}(),NodeTree.prototype.flatten=function(a,b){return b=b||[],a&&b.push(this),this.children.forEach(function(a){b.push(a),a.children.length&&a.flatten(!1,b)}),b},NodeTree.prototype.getChild=function(a){if(!a&&0!==a)throw new TypeError("missing argument indexList");if(a=a.toString(),!a.match(/^(?:\d\.?)*\d$/))throw new TypeError("unrecognized indexList format, require ^(\\d\\.?)*\\d$");var b,c=a.split("."),d=c.length-1;try{b=c.reduce(function(a,b,c){return c===d?a[b]:a[b].children},this.children)}catch(e){return null}return b},a.finder=function(a,b){if(b=b||document.body,!a)throw new TypeError("missing argument className");if(1!==b.nodeType)throw new TypeError("start container must be an element");var c=new NodeTree,d=0;return c.index=void 0,function e(b,c){return Array.prototype.forEach.call(b.children,function(b){if(b.classList.contains(a)){var f=new NodeTree(b,c,c.depth+1);return f.index=d++,c.children.push(f),e(b,f)}b.childElementCount&&e(b,c)}),c}(b,c)},a}(window.Slideshow||{});